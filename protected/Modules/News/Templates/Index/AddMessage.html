<!-- Modal -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
                <h4 class="modal-title">Востановление пароля</h4>
            </div>
            <div class="modal-body" >
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

                <section id="modal-body">
                    <form  name="sentMessage" class="form form-register1" id="resetlogin"  novalidate>

                        <div class="control-group">
                            <div class="controls">
                                <p id="valid"> Введите ваш e-mail</p>
                                <input type="text" class="form-control" id="mail" name="email" placeholder="e-mail"/>
                                <p class="help-block"></p>
                            </div>
                        </div>


                        <button type="submit" class="btn btn-lg btn-3d pull-right">Отправить</button><br />

                    </form>
                </section>

            </div><!-- End of Modal body -->
        </div><!-- End of Modal content -->
    </div><!-- End of Modal dialog -->
</div><!-- End of Modal -->

<div class="no-gutter row">
    <ul class="breadcrumb" style="background-color: transparent; margin-bottom: 5px">

        <li><a href="#" onclick="return content(1,1)">На главную</a></li>
        <li><a href="#" onclick="return mymessage()">Мои объявления</a></li>

    </ul>
    <!-- left side column -->

    <div class="col-md-3">
        <div class="panel panel-default" data-spy="affix" data-offset-top="20">
            <div class="panel-heading text-center" style="background-image:none;background-color:#888;color:#fff;">
                РУБРИКИ
            </div>
            <div class="panel-body">
                <t4:block path="/News//NewsAsMenu/" mode="1"/>


            </div>
        </div>
        <!--/panel-->
    </div>
    <!--/end left column-->


    <!--mid column-->
    <div class="col-md-9">
        <div class="panel">
            <div class="panel-heading text-center" style="background-color:#555;color:#eee;">{% if item.Pk == ''
                %}ПОДАТЬ ОБЪЯВЛЕНИЕ
                {% else%} МОИ ОБЪЯВЛЕНИЯ {% endif %}
            </div>
            <div id="message" class="panel-body">

                <article id="breadcrambs">
                    {% if item.Pk == '' %}
                    <h4 class="text-danger">Выберите рубрику</h4>
                    {% else %}
                    <div style="border: 1px">
                          <ol class="breadcrumb">
                            <li>Рубрика:</li>
                            {% for topic in parenttopic [1:] %}
                            <li><a>{{topic.title}}</a></li>
                            {% endfor %}
                            <li>{{item.topic.title
                                }}
                            </li>
                        </ol>
                    </div>
                    {% endif %}
                </article>



                {% if item.Pk!='' %}
                Стоймость: текст:
                <span id="prise">0</span>р.; Фото:<span id="prisephoto"></span>р.; VIP: <span id="prisevip"></span>р.;
                Итого: <span id="priseall"></span>р.
                <hr>

                {% endif %}

                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#panel1">Объявление # {{item.Pk}}  </a></li>
                    {% if item.Pk != '' and item.nopaid==0 %}
                    <li><a data-toggle="tab" href="#panel2">Фото обьявления</a></li>
                    {% endif %}

                </ul>

                <div class="tab-content">
                    <div id="panel1" class="tab-pane fade in active">
                        <br>

                        <form name="addmessage" method="POST" id="form-add-msg" action="javascript:void(null);" onsubmit="call()">
                            <input id="topicid" type="hidden" name="topic" value="{{item.topic.Pk}}">
                            <input id="idpk" type="hidden" name="id" value="{{item.Pk}}">


                            <div class="form-group">
                                <label for="message" id="textmessage">Текст объявления:</label>
                                <textarea id="text" class="form-control" name="text" rows="10"
                                          >{{item.text}} </textarea>
                            </div>

                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="glyphicon glyphicon-earphone"></i> </span>
                                    <input id="mobile" type="text" name="mfone" class="form-control"
                                           value="{{item.mfone}}" placeholder="телефон сотовый">
                                </div>
                                <br>

                                <div class="input-group">
                                    <span class="input-group-addon"><i
                                            class="glyphicon glyphicon-phone-alt"></i> </span>
                                    <input id="phone" type="text" name="fone" class="form-control" value="{{item.fone}}"
                                           placeholder="телефон городской">
                                </div>
                            </div>

                            {% if item.Pk != '' %}
                            <div class="checkbox">
                                <label>
                                    {% if item.vip==1 %}
                                    <input type="checkbox" id="vip" name="vip" checked value="1"> VIP статус
                                    {% else %}
                                    <input type="checkbox"  id="vip" name="vip" value="1"> присвоить VIP статус
                                    {% endif %}
                                    <span><a href="#">Показать</a> </span>
                                </label>
                            </div>
                            {% endif %}

                            <button type="submit" class="btn btn-defult" style="color: white;background-color: #77CCDD">
                                Сохранить
                            </button>
                            {% if item.Pk != '' %}
                            <button type="button" class="btn btn-default" onclick="return published()">Опубликовать</button>
                            <a href="/news/delete?id={{ item.Pk}}" id="del" class="btn btn-danger">Удалить</a>
                            {% endif %}
                            <button type="button" class="btn btn-default" onclick="return mymessage()">Выход</button>
                        </form>
                    </div>
                    <div id="panel2" class="tab-pane fade" style="height: 451px">

                        <div class="col-sm-10">


                            <h3 class="text-center"> Загрузка изображений </h3>

                            <hr>


                            <div id="fileuploader">Upload</div>
                            <button id="extrabutton" class="btn btn-success">Загрузить</button>
                            <p id="eventmessage"></p>


                            <section id="image">

                            </section>
                        </div>
                    </div>

                </div>


            </div>

        </div>
    </div>

    <script src="{{ asset('/Layouts/upload/jquery.uploadfile.min.js') }}"></script>
    <script src="{{ asset('/Layouts/Edit/js/ckeditconfig.js')}}"></script>





    <script type="text/javascript">

            tree();
            $('#first').click();
            $('#first').focus();
            $('#image').load('/news/LoadImage?id={{item.Pk}}');
            $("#mobile").mask("+7 999 999 9999");


            CKEDITOR.replace('text', {
                'customConfig': "{{ asset('/Layouts/Edit/js/ckeditconfig.js')}}"
            });

            CKEDITOR.instances['text'].on('contentDom', function () {
                        this.document.on('click', function (event) {

                            $('#textmessage').css('color', 'black');
                        })
                    }
            );

            $('#del').click(function () {
                if (confirm('Вы уверены что хотите удалить объявление?')) {
                    $.get($(this).attr('href'));
                    mymessage();

                }
                return false;

            })

            var extraObj = $("#fileuploader").uploadFile({
                url: "/news/UpLoadImage.json", fileName: "myfile",
                dragDrop: false,
                uploadStr: "Выберите файлы для загрузки",
                cancelStr: "Удалить",
                extErrorStr: "разрешено только  *",
                acceptFiles: "image/*",
                showPreview: true,
                autoSubmit: false,
                showDone: true,
                //onSuccess: alert("succes"),
                returnType: "json",

                afterUploadAll: function (obj) {
                    $("#eventsmessage").html($("#eventsmessage").html() + "<br/>All files are uploaded");

                },

                onSuccess: function (files, data, xhr, pd) {
                    $('.ajax-file-upload-statusbar').hide();
                    $('#image').load('/news/LoadImage?id={{item.Pk}}');

                },

                extraHTML: function () {
                    var html = '<input type="text" name="story" value="{{item.Pk}}">';

                    return html;
                },


            });

            $("#extrabutton").click(function () {

                extraObj.startUpload();

            });


            function priseall(words) {

                total = words - {{app.config.prise.nopaid}};
                $('#prisephoto').html({{app.config.prise.photo}} * {{item.image.count}});
                $('#prise').html(total * {{app.config.prise.word}});

            if (prisevip()) {
                    vip = {{app.config.prise.vip}};
                    $('#prisevip').html(vip);

                } else {
                    vip = 0;
                    $('#prisevip').html('0р.');

                }

                $('#priseall').html(total * {{app.config.prise.word}} + {{app.config.prise.photo}} * {{item.image.count}} + vip);
            }

            priseall({{words}});

            function prisevip() {


                if ($('#vip').attr('checked') == 'checked')
                    return true;
                else
                    return false;

            }

            function published() {
                call();
                $.get('/News/Published.json?id={{item.Pk}}');
                return false;
            }


            function call() {
                for (instance in CKEDITOR.instances)
                    CKEDITOR.instances[instance].updateElement();

                if (valid()) {

                    var msg = $('#form-add-msg').serialize();


                    $.ajax({
                        type: 'POST',
                        url: '/news//Save.json',
                        data: msg,
                        success: function (data) {

                            if (data.error) {

                                $('#textmessage').css('color', 'red');
                            } else {
                                addmessage(data.id);

                            }

                        }

                    })
                }
            }

            function valid() {

                if ($('#topicid').val() == '') {
                    $('#breadcrambs ').html("<h4 style='color: #9b0000'>Выберите рубрику!!!</h4>");
                    return  false;
                } else {
                    return true
                }
            }








    </script>








